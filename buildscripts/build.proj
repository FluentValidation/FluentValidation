<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0" DefaultTargets="default">
	<PropertyGroup>
		<BaseDir>$(MSBuildProjectDirectory)\..</BaseDir>
		<Configuration Condition="'$(Configuration)'==''" >Release</Configuration>
		<BuildDir>$(BaseDir)\build</BuildDir>
		<SolutionFile>$(BaseDir)\FluentValidation.sln</SolutionFile>
		<SilverlightSolution>$(BaseDir)\FluentValidation.Silverlight.sln</SilverlightSolution>
		<BuildSilverlight Condition="'$(BuildSilverlight)' == ''" >true</BuildSilverlight>
		<TestAssemblies>
			$(BaseDir)\src\FluentValidation.Tests\bin\$(Configuration)\FluentValidation.Tests.dll;
			$(BaseDir)\src\FluentValidation.Tests.Mvc3\bin\$(Configuration)\FluentValidation.Tests.Mvc3.dll;
			$(BaseDir)\src\FluentValidation.Tests.Mvc4\bin\$(Configuration)\FluentValidation.Tests.Mvc4.dll;
		</TestAssemblies>
		<MSBuildExtensions>$(BaseDir)\lib\msbuild\msbuild.community.tasks.dll</MSBuildExtensions>
	</PropertyGroup>
	
  <UsingTask AssemblyFile="$(MSBuildExtensions)" TaskName="MSBuild.Community.Tasks.NUnit" Condition="'$(teamcity_version)' == ''" />
  
	<Target Name="default" DependsOnTargets="Compile; CompileSilverlight; Test; Deploy" />
	
	<Target Name="Compile">
		<MSBuild Projects="$(SolutionFile)" Properties="Configuration=$(Configuration)"  Targets="Rebuild" />
  	<MSBuild Projects="$(SolutionFile)" Properties="Configuration=$(Configuration);PerformSigning=True" Targets="Rebuild" />
	</Target>

	<Target Name="CompileSilverlight">
		<MSBuild Projects="$(SilverlightSolution)" Properties="Configuration=$(Configuration)" Targets="Rebuild" Condition="'$(BuildSilverlight)' == 'true'" />
		<MSBuild Projects="$(SilverlightSolution)" Properties="Configuration=$(Configuration);PerformSigning=True" Targets="Rebuild" Condition="'$(BuildSilverlight)' == 'true'" />
	</Target>

	<Target Name="Test">
		<NUnit Assemblies="$(TestAssemblies)" ToolPath="$(BaseDir)\lib\nunit"  />
	</Target>

  <Target Name="Deploy">
    <RemoveDir Directories="$(BuildDir)" />
		
		<MSBuild Projects="Deployment.proj" Properties="Configuration=$(Configuration);BuildSilverlight=$(BuildSilverlight)" />
    <MSBuild Projects="Deployment.proj" Properties="Configuration=$(Configuration);BuildSilverlight=$(BuildSilverlight);PackageSuffix=-signed" />
    <!-- ... msbuild ... (include BuildSilverlight) (Configuration) (PackageSuffix) -->
  </Target>

	
	
	
	
	
</Project>